<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EduWeb Demo – Multi‑School</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <style>
    :root {
      --brand: #2563eb;
      --brand-dark: #1d4ed8;
      --brand-light: #60a5fa;
      --brand-gradient: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      --soft: #f8fafc;
      --soft-dark: #f1f5f9;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border: #e2e8f0;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
      --purple: #8b5cf6;
      --pink: #ec4899;
      --orange: #f97316;
      --teal: #14b8a6;
    }

    * {
      box-sizing: border-box;
    }

    body { 
      background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      background-attachment: fixed;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Glass Morphism Effect */
    .glass-card {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    }

    /* Modern Card Styles */
    .card {
      border: none;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }

    .card:hover::before {
      left: 100%;
    }

    .card-hover:hover { 
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
    }

    .shadow-soft { 
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    }

    /* Gradient Backgrounds */
    .brand-gradient { 
      background: var(--brand-gradient);
      position: relative;
      overflow: hidden;
    }

    .brand-gradient::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Modern Sidebar */
    .sidebar { 
      min-width: 280px; 
      background: linear-gradient(180deg, #1e1b4b 0%, #312e81 100%);
      color: #e5e7eb;
      border-right: 1px solid rgba(255,255,255,0.1);
      position: relative;
      backdrop-filter: blur(20px);
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    }

    .sidebar a { 
      color: #cbd5e1; 
      text-decoration: none; 
      display: block; 
      padding: 16px 20px; 
      border-radius: 16px; 
      margin: 6px 12px;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
      font-weight: 500;
    }

    .sidebar a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.6s;
    }

    .sidebar a:hover::before {
      left: 100%;
    }

    .sidebar a.active, .sidebar a:hover { 
      background: linear-gradient(135deg, #1d4ed8, #2563eb);
      color: #fff;
      transform: translateX(8px);
      box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
    }

    /* Modern Buttons */
    .btn {
      border-radius: 16px;
      font-weight: 600;
      padding: 12px 24px;
      transition: all 0.4s ease;
      border: none;
      position: relative;
      overflow: hidden;
      text-transform: none;
      letter-spacing: 0.5px;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn:hover::before {
      width: 400px;
      height: 400px;
    }

    .btn-primary {
      background: var(--brand-gradient);
      box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(37, 99, 235, 0.5);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }

    .btn-info {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }

    .btn-outline-primary {
      border: 2px solid var(--brand);
      color: var(--brand);
      background: transparent;
    }

    .btn-outline-primary:hover {
      background: var(--brand-gradient);
      color: white;
      transform: translateY(-3px);
      border-color: transparent;
    }

    /* Form Controls */
    .form-control, .form-select {
      border-radius: 16px;
      border: 2px solid var(--border);
      padding: 14px 18px;
      transition: all 0.4s ease;
      background: rgba(255,255,255,0.9);
      font-weight: 500;
    }

    .form-control:focus, .form-select:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 6px rgba(37, 99, 235, 0.1);
      transform: translateY(-2px);
      background: white;
    }

    /* Table Styling */
    .table {
      border-radius: 16px;
      overflow: hidden;
      background: white;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .table thead th {
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      border: none;
      font-weight: 700;
      color: var(--text-primary);
      padding: 20px 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.85em;
    }

    .table tbody tr {
      transition: all 0.3s ease;
    }

    .table tbody tr:hover {
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      transform: scale(1.01);
    }

    .table tbody td {
      padding: 18px 16px;
      border: none;
      border-bottom: 1px solid var(--border);
      font-weight: 500;
    }

    /* Badge Styling */
    .badge {
      border-radius: 12px;
      font-weight: 600;
      padding: 8px 16px;
      font-size: 0.8em;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .badge-status { 
      text-transform: capitalize;
      font-size: 0.85em;
    }

    /* Gallery */
    .gallery img { 
      object-fit: cover; 
      height: 180px;
      border-radius: 12px;
      transition: transform 0.4s ease;
    }

    .gallery img:hover {
      transform: scale(1.08);
    }

    /* Modal Styling */
    .modal-content {
      border-radius: 20px;
      border: none;
      box-shadow: 0 30px 80px rgba(0,0,0,0.2);
      backdrop-filter: blur(20px);
    }

    .modal-header {
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      border-bottom: 1px solid var(--border);
      border-radius: 20px 20px 0 0;
      padding: 24px 30px;
    }

    .modal-title {
      font-weight: 700;
      color: var(--text-primary);
    }

    /* Toast Styling */
    .toast {
      border-radius: 16px;
      border: none;
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
      backdrop-filter: blur(20px);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--soft);
      border-radius: 8px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--brand-gradient);
      border-radius: 8px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #1d4ed8, #2563eb);
    }

    /* Animation Classes */
    .fade-in {
      animation: fadeIn 0.6s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
      animation: slideIn 0.4s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(-30px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* Progress Bar Styling */
    .progress {
      background-color: var(--soft-dark);
      border-radius: 12px;
      overflow: hidden;
      height: 12px;
    }

    .progress-bar {
      border-radius: 12px;
      transition: width 0.8s ease;
      background: var(--brand-gradient);
    }

    /* Card Header Improvements */
    .card-header {
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      font-weight: 700;
      padding: 20px 24px;
      border-radius: 20px 20px 0 0;
    }

    /* Text Gradient */
    .text-gradient {
      background: var(--brand-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
    }

    /* Stats Cards */
    .stats-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 20px;
      padding: 24px;
      transition: all 0.4s ease;
    }

    .stats-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    /* Icon Animations */
    .fa-solid, .fa-regular {
      transition: transform 0.3s ease;
    }

    .card-hover:hover .fa-solid,
    .card-hover:hover .fa-regular {
      transform: scale(1.2) rotate(5deg);
    }

    /* Loading Spinner */
    .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid var(--border);
      border-top: 3px solid var(--brand);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Status Colors */
    .text-success { color: var(--success) !important; }
    .text-warning { color: var(--warning) !important; }
    .text-danger { color: var(--danger) !important; }
    .text-info { color: var(--info) !important; }
    .text-purple { color: var(--purple) !important; }
    .text-pink { color: var(--pink) !important; }
    .text-orange { color: var(--orange) !important; }
    .text-teal { color: var(--teal) !important; }

    .bg-success { background-color: var(--success) !important; }
    .bg-warning { background-color: var(--warning) !important; }
    .bg-danger { background-color: var(--danger) !important; }
    .bg-info { background-color: var(--info) !important; }
    .bg-purple { background-color: var(--purple) !important; }
    .bg-pink { background-color: var(--pink) !important; }
    .bg-orange { background-color: var(--orange) !important; }
    .bg-teal { background-color: var(--teal) !important; }

    /* Cursor */
    .cursor-pointer { cursor: pointer; }

    /* Additional Utility Classes */
    .glass-effect {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    /* Hover Effects for Cards */
    .card-hover {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-hover:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
    }

    /* Smooth Transitions */
    .fade-in {
      animation: fadeIn 0.8s ease-out;
    }

    .slide-up {
      animation: slideUp 0.6s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Floating Animation */
    .float {
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    /* Pulse Animation */
    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .card {
        border-radius: 12px;
        margin-bottom: 1rem;
        box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      }
      .btn {
        padding: 10px 16px;
        font-size: 0.95em;
      }
      .sidebar {
        min-width: 100vw;
        max-width: 100vw;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1050;
        height: 100vh;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        border-radius: 0 20px 20px 0;
      }
      .sidebar.show {
        transform: translateX(0);
      }
      .container, .container-fluid, .row, .col-12, .col-md-8, .col-lg-6, .col-lg-4, .col-lg-8, .col-lg-10, .col-lg-2 {
        padding-left: 8px !important;
        padding-right: 8px !important;
      }
      .p-4, .p-3 {
        padding: 1rem !important;
      }
      .gallery img, .gallery video {
        height: 120px !important;
      }
      .row-cols-md-3 > .col, .row-cols-md-4 > .col {
        flex: 0 0 50%;
        max-width: 50%;
      }
      .table-responsive {
        overflow-x: auto;
      }
      .table th, .table td {
        padding: 10px 6px;
        font-size: 0.95em;
      }
      .modal-dialog {
        max-width: 98vw;
        margin: 0.5rem auto;
      }
      .brand-gradient, .card-header {
        font-size: 1.1em;
      }
      .navbar {
        padding: 0.5rem 1rem;
      }
      .d-flex.gap-3 {
        gap: 0.5rem !important;
      }
      .form-control, .form-select {
        font-size: 1em;
        padding: 10px 12px;
      }
      .btn-group .btn {
        font-size: 0.95em;
        padding: 8px 10px;
      }
      .ratio-4x3, .ratio-16x9 {
        height: 120px !important;
      }
      .admin-view .row.g-3 > .col-md-4 {
        flex: 0 0 100%;
        max-width: 100%;
      }
      .row-cols-md-4 > .col, .row-cols-md-3 > .col {
        flex: 0 0 50%;
        max-width: 50%;
      }
      .sidebar a {
        padding: 12px 10px;
        font-size: 1em;
      }
      .card-body, .card-header {
        padding: 1rem !important;
      }
      .modal-content {
        border-radius: 12px;
      }
      .rounded-4 {
        border-radius: 12px !important;
      }
      .rounded-circle {
        width: 40px !important;
        height: 40px !important;
        font-size: 1.2em !important;
      }
      .h4, h4 {
        font-size: 1.1em !important;
      }
      .mb-3 {
        margin-bottom: 0.8rem !important;
      }
      .mt-4 {
        margin-top: 1rem !important;
      }
      /* Stack tables on small screens */
      .table thead { display: none; }
      .table tbody tr { display: block; margin-bottom: 0.75rem; }
      .table tbody td { display: flex; justify-content: space-between; align-items: center; }
      .table tbody td::before { content: attr(data-label); font-weight: 700; color: var(--text-secondary); margin-right: 12px; }
      .table tbody td.text-end { text-align: left !important; }
    }

    @media (max-width: 480px) {
      .gallery img, .gallery video, .ratio-4x3, .ratio-16x9 {
        height: 80px !important;
      }
      .row-cols-md-3 > .col, .row-cols-md-4 > .col {
        flex: 0 0 100%;
        max-width: 100%;
      }
      .navbar-brand {
        font-size: 1em !important;
      }
      .card-header, .brand-gradient {
        font-size: 1em !important;
      }
      .btn, .form-control, .form-select {
        font-size: 0.98em !important;
      }
    }
    }
  </style>
</head>
<body>

  <!-- Top Navbar (visible after login) -->
  <nav id="topNav" class="navbar navbar-expand-lg navbar-dark brand-gradient d-none">
    <div class="container-fluid">
      <button class="btn btn-outline-light btn-sm d-lg-none me-2" id="btnToggleSidebar"><i class="fa-solid fa-bars"></i></button>
      <a class="navbar-brand fw-bold" href="#"><i class="fa-solid fa-school me-2"></i>EduWeb Demo</a>
      <div class="d-flex align-items-center gap-3 ms-auto">
        <span class="badge bg-light text-dark" id="navSchool">School: –</span>
        <span class="badge bg-dark-subtle text-white" id="navRole">Role: –</span>
        <button class="btn btn-outline-light btn-sm" id="btnLogout"><i class="fa-solid fa-right-from-bracket me-1"></i>Đăng xuất</button>
      </div>
    </div>
  </nav>

  <!-- LOGIN VIEW -->
  <section id="viewLogin" class="container py-5">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 col-lg-6">
        <div class="card shadow-soft card-hover">
          <div class="card-body p-4">
            <div class="text-center mb-3">
              <div class="rounded-4 brand-gradient text-white p-3 mb-3 shadow-soft">
                <h3 class="mb-0"><i class="fa-solid fa-graduation-cap me-2"></i>Hệ thống Quản lý Giáo dục</h3>
                <div class="small opacity-75">Demo – Multi‑School (Phụ huynh & Admin)</div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Chọn Trường</label>
              <select id="loginSchool" class="form-select">
                <option value="A">Trường A – Hà Nội</option>
                <option value="B">Trường B – TP.HCM</option>
                <option value="C">Trường C – Đà Nẵng</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Tên đăng nhập</label>
              <input id="loginUser" class="form-control" placeholder="ví dụ: admin.a hoặc parent.a" />
            </div>
            <div class="mb-3">
              <label class="form-label">Mật khẩu</label>
              <input id="loginPass" type="password" class="form-control" placeholder="demo bất kỳ" />
            </div>

            <div class="mb-3">
              <label class="form-label">Chọn chế độ (Demo)</label>
              <div class="btn-group w-100" role="group">
                <input type="radio" class="btn-check" name="role" id="roleAdmin" autocomplete="off" checked>
                <label class="btn btn-outline-primary" for="roleAdmin"><i class="fa-solid fa-user-gear me-1"></i>Admin</label>

                <input type="radio" class="btn-check" name="role" id="roleParent" autocomplete="off">
                <label class="btn btn-outline-primary" for="roleParent"><i class="fa-solid fa-user me-1"></i>Phụ huynh</label>
              </div>
            </div>

            <button id="btnLogin" class="btn btn-primary w-100">
              <i class="fa-solid fa-right-to-bracket me-2"></i>Đăng nhập
            </button>

            <div class="text-center mt-3 small text-muted">Mẹo: chọn Admin để thấy đầy đủ chức năng quản trị. Chọn Phụ huynh để xem giao diện chỉ‑đọc.</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- APP WRAPPER (after login) -->
  <section id="appWrapper" class="container-fluid d-none">
    <div class="row">
      <!-- Sidebar (Admin only) -->
      <aside id="adminSidebar" class="col-12 col-lg-2 p-3 sidebar d-none">
        <div class="d-flex align-items-center gap-2 mb-3">
          <i class="fa-solid fa-sitemap"></i>
          <span class="fw-semibold">Quản trị trường</span>
        </div>
        <nav class="d-grid gap-2">
          <a href="#" data-target="admin-home" class="nav-link-sm active"><i class="fa-solid fa-house me-2"></i>Trang chủ</a>
          <a href="#" data-target="admin-students" class="nav-link-sm"><i class="fa-solid fa-children me-2"></i>Học sinh</a>
          <a href="#" data-target="admin-tuition" class="nav-link-sm"><i class="fa-solid fa-sack-dollar me-2"></i>Học phí</a>
          <a href="#" data-target="admin-media" class="nav-link-sm"><i class="fa-solid fa-photo-film me-2"></i>Media</a>
        </nav>
      </aside>

      <!-- Content Area -->
      <main id="contentArea" class="col-12 col-lg-10 p-4">
        <!-- ADMIN: HOME -->
        <div id="admin-home" class="admin-view d-none">
          <div class="row g-3">
            <div class="col-md-4">
              <div class="card shadow-soft card-hover">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <div class="text-muted">Tổng số lớp</div>
                      <div class="h4 mb-0" id="statClasses">3</div>
                    </div>
                    <i class="fa-solid fa-layer-group fa-2x text-primary"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card shadow-soft card-hover">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <div class="text-muted">Sĩ số</div>
                      <div class="h4 mb-0" id="statStudents">0</div>
                    </div>
                    <i class="fa-solid fa-users fa-2x text-primary"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card shadow-soft card-hover">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <div class="text-muted">Đang nợ học phí</div>
                      <div class="h4 mb-0" id="statDebt">0</div>
                    </div>
                    <i class="fa-solid fa-triangle-exclamation fa-2x text-primary"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card shadow-soft mt-4">
            <div class="card-header bg-white"><strong>Tóm tắt theo lớp</strong></div>
            <div class="card-body">
              <div id="summaryByClass" class="row g-3"></div>
            </div>
          </div>
        </div>

        <!-- ADMIN: STUDENTS -->
        <div id="admin-students" class="admin-view d-none">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Danh sách học sinh</h5>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalStudent"><i class="fa-solid fa-plus me-1"></i>Thêm học sinh</button>
          </div>
          <div class="card shadow-soft">
            <div class="card-body">
              <div class="row g-2 mb-3">
                <div class="col-md-3"><input id="filterName" class="form-control" placeholder="Tìm theo tên…"></div>
                <div class="col-md-3">
                  <select id="filterClass" class="form-select">
                    <option value="">Tất cả lớp</option>
                  </select>
                </div>
                <div class="col-md-3 ms-auto text-end"><button id="btnExportCSV" class="btn btn-outline-secondary"><i class="fa-solid fa-file-csv me-1"></i>Xuất CSV</button></div>
              </div>
              <div class="table-responsive">
                <table class="table table-hover align-middle" id="tblStudents">
                  <thead class="table-light">
                    <tr>
                      <th>#</th><th>Họ tên</th><th>Lớp</th><th>Ngày sinh</th><th>Cân nặng</th><th>Chiều cao</th><th class="text-end">Thao tác</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- ADMIN: TUITION -->
        <div id="admin-tuition" class="admin-view d-none">
          <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
            <h5 class="mb-0">Quản lý học phí</h5>
            <div class="ms-auto"></div>
            <label class="form-label mb-0 me-2">Tháng</label>
            <input type="month" id="tuitionMonth" class="form-control" style="width: 220px;">
          </div>
          <div class="card shadow-soft">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped align-middle" id="tblTuition">
                  <thead class="table-light">
                    <tr><th>#</th><th>Họ tên</th><th>Lớp</th><th>Trạng thái</th></tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- ADMIN: MEDIA -->
        <div id="admin-media" class="admin-view d-none">
          <div class="row g-3">
            <div class="col-lg-4">
              <div class="card shadow-soft">
                <div class="card-header bg-white"><strong>Upload Ảnh/Video</strong></div>
                <div class="card-body">
                  <div class="mb-3">
                    <label class="form-label">Gắn cho</label>
                    <select id="mediaAttachType" class="form-select">
                      <option value="class">Theo lớp</option>
                      <option value="student">Theo học sinh</option>
                    </select>
                  </div>
                  <div class="mb-3" id="wrapClass">
                    <label class="form-label">Chọn lớp</label>
                    <select id="mediaClass" class="form-select"></select>
                  </div>
                  <div class="mb-3 d-none" id="wrapStudent">
                    <label class="form-label">Chọn học sinh</label>
                    <select id="mediaStudent" class="form-select"></select>
                  </div>
                  <div class="mb-3">
                    <input id="mediaFile" type="file" class="form-control" accept="image/*,video/*">
                  </div>
                  <button id="btnUpload" class="btn btn-primary w-100"><i class="fa-solid fa-cloud-arrow-up me-1"></i>Tải lên</button>
                  <div class="small text-muted mt-2">(Demo: chỉ lưu giả lập trong bộ nhớ trình duyệt)</div>
                </div>
              </div>
            </div>
            <div class="col-lg-8">
              <div class="card shadow-soft">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                  <strong>Thư viện Media</strong>
                  <div style="max-width:260px" class="w-100 ms-3">
                    <input id="searchMedia" class="form-control" placeholder="Tìm theo tên file…">
                  </div>
                </div>
                <div class="card-body">
                  <div id="mediaGallery" class="row row-cols-2 row-cols-md-3 g-3 gallery"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- PARENT DASHBOARD -->
        <div id="parent-view" class="d-none">
          <div class="row g-3">
            <div class="col-lg-4">
              <div class="card shadow-soft">
                <div class="card-header bg-white"><strong>Thông tin học sinh</strong></div>
                <div class="card-body" id="parentStudentInfo"></div>
              </div>
            </div>
            <div class="col-lg-8">
              <div class="card shadow-soft mb-3">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                  <strong>Học phí theo tháng</strong>
                  <input type="month" id="parentMonth" class="form-control" style="width: 220px;">
                </div>
                <div class="card-body" id="parentTuition"></div>
              </div>
              <div class="card shadow-soft">
                <div class="card-header bg-white"><strong>Media của lớp/học sinh</strong></div>
                <div class="card-body">
                  <div id="parentMedia" class="row row-cols-2 row-cols-md-4 g-3 gallery"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </main>
    </div>
  </section>

  <!-- Modal: Create/Edit Student -->
  <div class="modal fade" id="modalStudent" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thêm / Sửa học sinh</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Họ tên</label>
              <input id="stFullName" class="form-control" />
            </div>
            <div class="col-md-3">
              <label class="form-label">Lớp</label>
              <select id="stClass" class="form-select"></select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Ngày sinh</label>
              <input id="stDob" type="date" class="form-control" />
            </div>
            <div class="col-md-3">
              <label class="form-label">Cân nặng (kg)</label>
              <input id="stWeight" type="number" class="form-control" />
            </div>
            <div class="col-md-3">
              <label class="form-label">Chiều cao (cm)</label>
              <input id="stHeight" type="number" class="form-control" />
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
          <button id="btnSaveStudent" class="btn btn-primary">Lưu</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080;">
    <div id="liveToast" class="toast align-items-center text-bg-success border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body" id="toastMsg">Đã lưu!</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Hiện/ẩn sidebar khi bấm nút menu trên mobile
    document.addEventListener('DOMContentLoaded', function() {
      var btnToggleSidebar = document.getElementById('btnToggleSidebar');
      var sidebar = document.getElementById('adminSidebar');
      if (btnToggleSidebar && sidebar) {
        btnToggleSidebar.addEventListener('click', function() {
          sidebar.classList.toggle('show');
        });
      }
      // Ẩn sidebar khi click ra ngoài (mobile)
      document.addEventListener('click', function(e) {
        if (window.innerWidth <= 768 && sidebar && sidebar.classList.contains('show')) {
          if (!sidebar.contains(e.target) && e.target !== btnToggleSidebar) {
            sidebar.classList.remove('show');
          }
        }
      });
    });
    // ===== Demo In‑Memory Store (per school) =====
    const demoDB = {
      A: { classes:["1A","1B","1C"], students:[], tuition:{}, media:[] },
      B: { classes:["2A","2B","2C"], students:[], tuition:{}, media:[] },
      C: { classes:["3A","3B","3C"], students:[], tuition:{}, media:[] },
    };

    // Seed demo students (50 students over 3 classes)
    function seedStudentsIfEmpty(s){
      const db = demoDB[s];
      if (db.students.length) return;
      let id = 1;
      const names = [
        "Nguyễn Văn A","Trần Thị B","Lê Văn C","Phạm Thị D","Hoàng Gia E","Đỗ Minh F","Võ An G","Bùi Khánh H","Đặng Hải I","Phan Mai K",
        "Vũ Nhật L","Đào Quỳnh M","Trịnh Duy N","Tạ Hồng O","Chu Hải P","Ngô Thanh Q","Hà Bảo R","La Minh S","Cao Tuấn T","Tôn Nữ U",
        "Tống Việt V","Thái Yến W","Nghiêm Anh X","Huỳnh Thu Y","Mai Khánh Z","Đinh An 1","Phùng Huy 2","Từ Gia 3","Đan Anh 4","Lâm Nhật 5",
        "Lương Kỳ 6","Đoàn Nhi 7","Trần Hậu 8","Nguyễn Diệu 9","Phạm Thư 10","Vũ Uyên 11","Đặng Lâm 12","Phan Hào 13","Đỗ Lộc 14","Bùi Thy 15",
        "Hoàng Linh 16","Lê Hảo 17","Chu Phúc 18","Tạ Nghĩa 19","Ngô Hậu 20","La Hân 21","Cao Mai 22","Tôn Vũ 23","Tống Vy 24","Thái Duy 25"
      ];
      for (let i=0;i<50;i++){
        const cls = db.classes[i%db.classes.length];
        const weight = 18 + (i%8);
        const height = 115 + (i%12);
        const dob = new Date(2015 + (i%2), (i%12), (i%28)+1);
        db.students.push({ id:id++, full_name:names[i%names.length], class:cls, dob:dob.toISOString().slice(0,10), weight, height });
      }
    }

    // ===== State =====
    let current = { role:null, school:"A", user:null, studentId:null };

    // ===== Utilities =====
    const toast = new bootstrap.Toast(document.getElementById('liveToast'));
    function notify(msg){ document.getElementById('toastMsg').innerText = msg; toast.show(); }
    function formatDate(d){
      if (!d) return ""; const [y,m,day] = d.split('-'); return `${day}/${m}/${y}`;
    }

    // ===== Login =====
    document.getElementById('btnLogin').addEventListener('click', ()=>{
      const school = document.getElementById('loginSchool').value;
      const role = document.getElementById('roleParent').checked ? 'parent' : 'admin';
      const username = document.getElementById('loginUser').value || (role==='admin' ? 'admin.demo' : 'parent.demo');
      current = { role, school, user: username, studentId: role==='parent' ? 1 : null };
      seedStudentsIfEmpty(school);
      enterApp();
    });

    document.getElementById('btnLogout').addEventListener('click', ()=>{
      document.getElementById('appWrapper').classList.add('d-none');
      document.getElementById('topNav').classList.add('d-none');
      document.getElementById('viewLogin').classList.remove('d-none');
      const sb = document.getElementById('adminSidebar');
      sb.classList.remove('show');
    });

    function enterApp(){
      const {role, school} = current;
      // top bar
      document.getElementById('navSchool').innerText = `School: ${school}`;
      document.getElementById('navRole').innerText = `Role: ${role}`;

      // Reset sidebar state
      const sidebar = document.getElementById('adminSidebar');
      const btnToggleSidebar = document.getElementById('btnToggleSidebar');
      if (sidebar) {
        sidebar.classList.remove('show');
      }
      if (btnToggleSidebar) {
        btnToggleSidebar.classList.remove('d-none');
      }

      // show/hide wrappers
      document.getElementById('viewLogin').classList.add('d-none');
      document.getElementById('topNav').classList.remove('d-none');
      document.getElementById('appWrapper').classList.remove('d-none');

      if (role==='admin') {
        sidebar.classList.remove('d-none');
        btnToggleSidebar.classList.remove('d-none');
        switchAdminView('admin-home');
        renderAdminHome();
        buildFilters();
        renderStudents();
        initTuition();
        renderTuition();
        initMediaControls();
        renderMedia();
      } else {
        sidebar.classList.add('d-none');
        btnToggleSidebar.classList.add('d-none');
        sidebar.classList.remove('show');
        showParentView();
      }
    }

    // ===== Admin Sidebar Nav =====
    document.querySelectorAll('.sidebar a.nav-link-sm').forEach(a => {
      a.addEventListener('click', (e)=>{
        e.preventDefault();
        document.querySelectorAll('.sidebar a.nav-link-sm').forEach(x=>x.classList.remove('active'));
        a.classList.add('active');
        switchAdminView(a.dataset.target);
        if (window.innerWidth <= 768) {
          document.getElementById('adminSidebar').classList.remove('show');
        }
      });
    });

    // Mobile sidebar toggle
    document.getElementById('btnToggleSidebar').addEventListener('click', ()=>{
      const sb = document.getElementById('adminSidebar');
      sb.classList.toggle('show');
    });

    function switchAdminView(id){
      document.querySelectorAll('.admin-view').forEach(v=>v.classList.add('d-none'));
      document.getElementById(id).classList.remove('d-none');
    }

    // ===== Admin Home Stats =====
    function renderAdminHome(){
      const db = demoDB[current.school];
      // Stats
      document.getElementById('statClasses').innerText = db.classes.length;
      document.getElementById('statStudents').innerText = db.students.length;
      const debtCount = Object.values(db.tuition).filter(x=>x.status==='debt').length;
      document.getElementById('statDebt').innerText = debtCount;
      // Summary by class
      const wrap = document.getElementById('summaryByClass');
      wrap.innerHTML = '';
      db.classes.forEach(cls=>{
        const total = db.students.filter(s=>s.class===cls).length;
        const paid = Object.values(db.tuition).filter(t=>t.class===cls && t.status==='paid').length;
        const debt = Object.values(db.tuition).filter(t=>t.class===cls && t.status==='debt').length;
        const el = document.createElement('div');
        el.className = 'col-md-4';
        el.innerHTML = `
          <div class="p-3 rounded-4 bg-white shadow-soft card-hover">
            <div class="d-flex justify-content-between"><strong>Lớp ${cls}</strong><span class="text-muted">${total} HS</span></div>
            <div class="mt-2 small">Đã đóng: <span class="badge text-bg-success">${paid}</span> &nbsp; Nợ: <span class="badge text-bg-danger">${debt}</span></div>
          </div>`;
        wrap.appendChild(el);
      });
    }

    // ===== Admin Students =====
    function buildFilters(){
      const db = demoDB[current.school];
      const classSel = document.getElementById('filterClass');
      const stClassSel = document.getElementById('stClass');
      const mediaClassSel = document.getElementById('mediaClass');
      [classSel, stClassSel, mediaClassSel].forEach(sel=>{ sel.innerHTML=''; });
      const optAll = document.createElement('option'); optAll.value=''; optAll.textContent='Tất cả lớp';
      classSel.appendChild(optAll);
      db.classes.forEach(c=>{
        const o1=document.createElement('option');o1.value=c;o1.textContent=c;classSel.appendChild(o1);
        const o2=document.createElement('option');o2.value=c;o2.textContent=c;stClassSel.appendChild(o2);
        const o3=document.createElement('option');o3.value=c;o3.textContent=c;mediaClassSel.appendChild(o3);
      });
      // student list for media attach
      const mediaStudentSel = document.getElementById('mediaStudent');
      mediaStudentSel.innerHTML='';
      db.students.forEach(s=>{
        const o=document.createElement('option');o.value=s.id;o.textContent=`${s.full_name} (${s.class})`;mediaStudentSel.appendChild(o);
      });
    }

    document.getElementById('filterName').addEventListener('input', renderStudents);
    document.getElementById('filterClass').addEventListener('change', renderStudents);

    function renderStudents(){
      const db = demoDB[current.school];
      const tbody = document.querySelector('#tblStudents tbody');
      const name = document.getElementById('filterName').value.toLowerCase();
      const cls = document.getElementById('filterClass').value;
      tbody.innerHTML='';
      db.students
        .filter(s => (!name || s.full_name.toLowerCase().includes(name)) && (!cls || s.class===cls))
        .forEach((s,idx)=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td data-label="#">${idx+1}</td>
            <td data-label="Họ tên">${s.full_name}</td>
            <td data-label="Lớp">${s.class}</td>
            <td data-label="Ngày sinh">${formatDate(s.dob)}</td>
            <td data-label="Cân nặng">${s.weight} kg</td>
            <td data-label="Chiều cao">${s.height} cm</td>
            <td class="text-end" data-label="Thao tác">
              <button class="btn btn-sm btn-outline-primary me-2" onclick="editStudent(${s.id})"><i class='fa-solid fa-pen'></i></button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteStudent(${s.id})"><i class='fa-solid fa-trash'></i></button>
            </td>`;
          tbody.appendChild(tr);
        });
    }

    // Export CSV (simple)
    document.getElementById('btnExportCSV').addEventListener('click', ()=>{
      const db = demoDB[current.school];
      const rows = ["id,full_name,class,dob,weight,height", ...db.students.map(s=>[s.id,`"${s.full_name}"`,s.class,s.dob,s.weight,s.height].join(','))];
      const blob = new Blob([rows.join('\n')], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`students_${current.school}.csv`; a.click();
    });

    // Create/Edit student
    let editingId = null;
    document.getElementById('btnSaveStudent').addEventListener('click', ()=>{
      const db = demoDB[current.school];
      const payload = {
        full_name: document.getElementById('stFullName').value.trim(),
        class: document.getElementById('stClass').value,
        dob: document.getElementById('stDob').value,
        weight: Number(document.getElementById('stWeight').value||0),
        height: Number(document.getElementById('stHeight').value||0),
      };
      if (!payload.full_name || !payload.class || !payload.dob){ alert('Vui lòng nhập đủ Họ tên, Lớp, Ngày sinh'); return; }
      if (editingId){
        const idx = db.students.findIndex(x=>x.id===editingId);
        db.students[idx] = { ...db.students[idx], ...payload };
        notify('Đã cập nhật học sinh');
      } else {
        const nextId = db.students.length? Math.max(...db.students.map(x=>x.id))+1 : 1;
        db.students.push({ id: nextId, ...payload });
        notify('Đã thêm học sinh mới');
      }
      editingId = null;
      bootstrap.Modal.getInstance(document.getElementById('modalStudent')).hide();
      buildFilters();
      renderStudents();
      renderAdminHome();
    });

    window.editStudent = (id)=>{
      const db = demoDB[current.school];
      const s = db.students.find(x=>x.id===id);
      editingId = id;
      document.getElementById('stFullName').value = s.full_name;
      document.getElementById('stClass').value = s.class;
      document.getElementById('stDob').value = s.dob;
      document.getElementById('stWeight').value = s.weight;
      document.getElementById('stHeight').value = s.height;
      new bootstrap.Modal('#modalStudent').show();
    }

    window.deleteStudent = (id)=>{
      if (!confirm('Xóa học sinh này?')) return;
      const db = demoDB[current.school];
      db.students = db.students.filter(x=>x.id!==id);
      renderStudents();
      buildFilters();
      renderAdminHome();
    }

    // ===== Admin Tuition =====
    function initTuition(){
      const m = new Date();
      document.getElementById('tuitionMonth').value = `${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,'0')}`;
    }

    document.getElementById('tuitionMonth').addEventListener('change', renderTuition);

    function renderTuition(){
      const db = demoDB[current.school];
      const month = document.getElementById('tuitionMonth').value;
      const tbody = document.querySelector('#tblTuition tbody');
      tbody.innerHTML='';
      db.students.forEach((s, idx)=>{
        const key = `${s.id}_${month}`;
        if (!db.tuition[key]) db.tuition[key] = { student_id:s.id, class:s.class, month, status:'unpaid' };
        const st = db.tuition[key];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td data-label="#">${idx+1}</td>
          <td data-label="Họ tên">${s.full_name}</td>
          <td data-label="Lớp">${s.class}</td>
          <td data-label="Trạng thái">
            <select class="form-select form-select-sm" data-key="${key}">
              <option value="paid" ${st.status==='paid'?'selected':''}>Đã đóng</option>
              <option value="unpaid" ${st.status==='unpaid'?'selected':''}>Chưa đóng</option>
              <option value="debt" ${st.status==='debt'?'selected':''}>Nợ</option>
            </select>
          </td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('select').forEach(sel=>{
        sel.addEventListener('change', (e)=>{
          const k = e.target.dataset.key; db.tuition[k].status = e.target.value; notify('Đã cập nhật trạng thái học phí'); renderAdminHome();
        });
      });
    }

    // ===== Admin Media =====
    function initMediaControls(){
      const typeSel = document.getElementById('mediaAttachType');
      const wrapClass = document.getElementById('wrapClass');
      const wrapStudent = document.getElementById('wrapStudent');
      typeSel.addEventListener('change', ()=>{
        if (typeSel.value==='class'){ wrapClass.classList.remove('d-none'); wrapStudent.classList.add('d-none'); }
        else { wrapClass.classList.add('d-none'); wrapStudent.classList.remove('d-none'); }
      });
      document.getElementById('btnUpload').addEventListener('click', uploadMediaDemo);
      document.getElementById('searchMedia').addEventListener('input', renderMedia);
    }

    function uploadMediaDemo(){
      const fileInput = document.getElementById('mediaFile');
      const f = fileInput.files[0];
      if (!f){ alert('Vui lòng chọn file'); return; }
      const db = demoDB[current.school];
      const typeSel = document.getElementById('mediaAttachType').value;
      const cls = document.getElementById('mediaClass').value;
      const sid = Number(document.getElementById('mediaStudent').value || 0);
      const reader = new FileReader();
      reader.onload = (e)=>{
        db.media.unshift({ id: Date.now(), url: e.target.result, name: f.name, mime: f.type, attached: typeSel==='class'? {class:cls} : {student_id:sid} });
        renderMedia();
        notify('Upload thành công (demo)');
        fileInput.value = '';
      };
      reader.readAsDataURL(f);
    }

    function renderMedia(){
      const db = demoDB[current.school];
      const q = document.getElementById('searchMedia').value?.toLowerCase()||'';
      const wrap = document.getElementById('mediaGallery');
      wrap.innerHTML = '';
      db.media.filter(m=>!q || m.name.toLowerCase().includes(q)).forEach(m=>{
        const col = document.createElement('div'); col.className = 'col';
        const isImg = m.mime.startsWith('image');
        col.innerHTML = `
          <div class="card shadow-soft h-100">
            <div class="ratio ${isImg? 'ratio-4x3':'ratio-16x9'}">
              ${isImg? `<img src="${m.url}" class="card-img-top" alt="${m.name}">` : `<video src="${m.url}" controls class="w-100 h-100"></video>`}
            </div>
            <div class="card-body p-2">
              <div class="small text-truncate" title="${m.name}"><i class="fa-regular fa-file me-1"></i>${m.name}</div>
              <div class="small text-muted">${m.attached.class? `Lớp ${m.attached.class}` : `HS #${m.attached.student_id}`}</div>
            </div>
          </div>`;
        wrap.appendChild(col);
      });
    }

    // ===== Parent View =====
    function showParentView(){
      document.querySelectorAll('.admin-view').forEach(v=>v.classList.add('d-none'));
      const p = document.getElementById('parent-view');
      p.classList.remove('d-none');
      const m = new Date();
      document.getElementById('parentMonth').value = `${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,'0')}`;
      renderParentInfo();
      renderParentTuition();
      renderParentMedia();
      document.getElementById('parentMonth').addEventListener('change', renderParentTuition);
    }

    function renderParentInfo(){
      const db = demoDB[current.school];
      const s = db.students[0]; // demo: phụ huynh xem HS đầu tiên
      current.studentId = s?.id || 1;
      const wrap = document.getElementById('parentStudentInfo');
      if (!s){ wrap.innerHTML = '<em>Chưa có dữ liệu học sinh.</em>'; return; }
      wrap.innerHTML = `
        <div class="d-flex align-items-center gap-3">
          <div class="rounded-circle bg-primary-subtle text-primary d-flex align-items-center justify-content-center" style="width:56px;height:56px;">
            <i class="fa-solid fa-user"></i>
          </div>
          <div>
            <div class="fw-semibold">${s.full_name}</div>
            <div class="small text-muted">Lớp ${s.class} • DOB ${formatDate(s.dob)}</div>
          </div>
        </div>
        <hr/>
        <div class="row g-2 small">
          <div class="col-6">Cân nặng: <strong>${s.weight} kg</strong></div>
          <div class="col-6">Chiều cao: <strong>${s.height} cm</strong></div>
        </div>`;
    }

    function renderParentTuition(){
      const db = demoDB[current.school];
      const month = document.getElementById('parentMonth').value;
      const key = `${current.studentId}_${month}`;
      if (!db.tuition[key]) db.tuition[key] = { student_id: current.studentId, class: db.students.find(x=>x.id===current.studentId)?.class, month, status:'unpaid' };
      const st = db.tuition[key];
      const wrap = document.getElementById('parentTuition');
      const map = { paid:['Đã đóng','success'], unpaid:['Chưa đóng','secondary'], debt:['Nợ','danger'] };
      wrap.innerHTML = `
        <div>Tháng <strong>${month}</strong>: <span class="badge text-bg-${map[st.status][1]} badge-status">${map[st.status][0]}</span></div>
        <div class="text-muted small mt-2">* Phụ huynh chỉ xem thông tin, không thể chỉnh sửa.</div>`;
    }

    function renderParentMedia(){
      const db = demoDB[current.school];
      const s = db.students.find(x=>x.id===current.studentId);
      const wrap = document.getElementById('parentMedia');
      wrap.innerHTML='';
      db.media
        .filter(m => (m.attached.class && m.attached.class===s.class) || (m.attached.student_id && m.attached.student_id===s.id))
        .forEach(m=>{
          const col = document.createElement('div'); col.className='col';
          const isImg = m.mime?.startsWith('image');
          col.innerHTML = `
            <div class="card shadow-soft h-100">
              <div class="ratio ${isImg? 'ratio-4x3':'ratio-16x9'}">
                ${isImg? `<img src="${m.url}" class="card-img-top" alt="${m.name}">` : `<video src="${m.url}" controls class="w-100 h-100"></video>`}
              </div>
              <div class="card-body p-2 small text-truncate" title="${m.name}">${m.name}</div>
            </div>`;
          wrap.appendChild(col);
        });
    }
  </script>
</body>
</html>
